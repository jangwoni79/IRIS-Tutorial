데이터 파일을 IRIS 로 업로드하기 
=======================================================================================

| 공공 데이터를 로컬 PC 로 내려 받아서 전처리를 한 후에 IRIS 의 MinIO 에 업로드하는 방법을 설명합니다.
| IRIS 에 업로드된 파일을 ``데이터모델`` 로 생성하여 Studio, Analyzer 를 통해 분석과 함께 보고서로 만들 수 있습니다.
|


공공 데이터 내려 받기
-------------------------------------------------------------------

| 대상 데이터는 `서울시 인구 추이 (주민등록인구) 통계 <https://data.seoul.go.kr/dataList/418/S/2/datasetView.do?tab=S>`__ 입니다.
| 해당 데이터의 기간을 1990년 ~ 2019년 까지로 하여 text 로 다운로드합니다.
| 
- 데이터를 다운로드 한 후 
- 컬럼 이름을 영문으로 다시 만들고
- 숫자에 표시된 콤마를 제거한 후에 
- 구분자를 콤마로 수정하여 
- csv 로 저장합니다.

|

.. image:: images/minio_pop_01.png
   :alt: text data

|


데이터 업로드 / 데이터 모델 생성하기
-------------------------------------------------------------------

| 로컬 PC 에 있는 파일들을 MinIO 에 업로드합니다.
| MinIO 에 업로드한 csv 파일은 IRIS의 데이터모델로 만들어야 ``Analyzer`` , ``Studio`` 메뉴에서 활용할 수 있습니다.
|

- IRIS 에서 제공하는 기본 Object 저장소로 해당 데이터 파일을 업로드합니다.

    - 메인메뉴에서 **Discovery** 를 클릭 -  ``파일 브라우저`` 에서 **MINIO** 를 선택합니다.
    - 데이터가 저장될 새 폴더를 생성하거나 이동한 후에
    - 상단의 **업로드** 를 클릭하여 업로드 절차를 진행합니다.
|

.. image:: images/minio_pop_02.png
   :alt: file upload

|

- 데이터모델 생성하기

    - 메인메뉴에서 **Discovery** 를 클릭 - ``데이터 모델`` 로 진입합니다.
    - **새 모델** 을 클릭하면 새모델을 설정하는 팝업창이 뜹니다.
    - 모델 이름, 연결정보로 OBJECTSTORAGE 를 선택하고, 연결정보를 콤보박스에서 선택합니다.
    - 대상데이터를 MinIO 브라우저에서 업로드한 파일이름을 찾아서 선택합니다.

|

- 데이터모델 컬럼 설정하기

    MinIO 에 저장된 각 컬럼의 유형은 TEXT 로 저장되므로, 데이터모델에서 컬럼별 유헝을 변경해야 합니다. 유형은 TEXT, REAL, INTEGER, BIGINT, DATE, TIMESTAMP 로 변환할 수 있습니다.
    또한 컬럼명이 영문이라 직관적이지 않으면, 한글 별칭을 추가로 입력할 수 있습니다. 

|

.. image:: images/minio_pop_03.png
   :alt: data model





데이터 모델 관련 활용 팁
=======================================================================================


한글 깨짐 문제
-------------------------------------------------------------------

| 공공데이터 포털에서 csv를 다운받은 경우에는 인코딩이 ANSI 로 되어 있습니다.
| 이 경우에는 IRIS에서 데이터 모델 생성시에 아래 그림과 같이 한글이 깨지는 경우가 발생할 수 있습니다.
| utf-8 로 인코딩하는 추가 절차가 필요합니다.

.. image:: images/encoding_ansi.png
   :alt: 인코딩 ANSI
   

|

1. csv 데이터를 인코딩 해주는 과정을 진행하기 위해서 ``메모장`` 에서 파일을 엽니다.

.. image:: images/encoding_utf_8_1.png
   :alt: 인코딩 UTF-8 변경
   
   
|

2. 데이터 파일을 메모장으로 열고, ``다른 이름으로 저장하기`` 를 클릭한 후 인코딩을 **UTF-8** 로 바꿔줍니다.

.. image:: images/encoding_utf_8_2.png
   :alt: 인코딩 UTF-8 변경
   
   
|

3. 인코딩 UTF-8 로 저장한 파일을 IRIS 에 업로드하여 데이터모델 생성 과정을 진행합니다.

.. image:: images/encoding_utf_8_3.png
   :alt: 인코딩 UTF-8 변경



데이터 모델 뷰 생성하기
-------------------------------------------------------------------

| 데이터 모델 목록에 있는 데이터 모델에 대해 뷰(View) 를 생성할 수 있습니다.
| 데이터 모델을 집계, 변환, 필터링 등 검색어로 전처리하여 데이터 모델 뷰로 생성하거나
| 다른 데이터 모델과 join 하여 모델 뷰를 생성하여 Studio, Analyzer 에서 데이터 모델처럼 사용할 수 있습니다. 

.. image:: images/getting_start_49.png
   :alt: data model 검색



- 데이터 모델 뷰를 활용하면 좋은 점

    - 보고서를 만들 때 검색어를 더 단순하게 사용할 수 있습니다.
    - 다른 사용자가 공유한 데이터 모델 중 연결 정보권한이 없어 복사할 수 없는 데이터모델은 모델 뷰 생성으로 복사 기능을 대신할 수 있습니다.
|


.. image:: images/getting_start_50.png
   :alt: data model 검색

|

예시 : 다른 데이터 모델과 join 하여 생성한 모델 뷰
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

| 대상 데이터 모델  : EDU_SEOUL_GU_FIRE_CAUSE
|

- 검색어

.. code::

  * |  join LEFT_OUTER  EDU_SEOUL_GU_WGS84  EDU_SEOUL_GU_WGS84.GU_NAME = EDU_SEOUL_GU_FIRE_CAUSE.GU_NAME

|

- 모델 뷰 생성  : EDU_SEOUL_GU_FIRE_CAUSE_행정구GEOM_VIEW

.. image:: images/getting_start_19.png
   :alt: data model  view 19


.. image:: images/getting_start_20.png
   :alt: data model view 20

